intent: kubernetes_node_pool
flavor: aws
version: '1.0'
clouds:
- aws
title: EKS Auto Mode Karpenter NodePool Manager
description: Creates and manages dynamic node pools for EKS Auto Mode clusters with
  intelligent scaling and cost optimization.
inputs:
  kubernetes_details:
    type: '@facets/eks'
    displayName: EKS Cluster
    description: The EKS cluster where the node pool will be created
    optional: false
    providers:
    - helm
    - kubernetes
    - kubernetes-alpha
  network_details:
    type: '@facets/aws-vpc-details'
    displayName: VPC Network
    description: VPC network details for node placement
    optional: false
outputs:
  default:
    type: '@facets/kubernetes_nodepool'
    title: Kubernetes Nodepool
  attributes:
    type: '@facets/aws_karpenter_nodepool'
    title: AWS Karpenter NodePool
spec:
  type: object
  x-ui-order:
  - instance_requirements
  - scaling
  - networking
  - storage
  - scheduling
  - tags
  properties:
    instance_requirements:
      type: object
      title: Instance Requirements
      description: Define what types of EC2 instances this node pool can use.
      x-ui-toggle: true
      properties:
        instance_classification:
          type: string
          title: Instance Classification
          description: Select instance classification which will be used to define
            compute resources for EKS node pool
          enum:
          - Instance Category
          - Instance Family
          - Instance Types
        instance_family:
          type: string
          title: Instance Family
          description: Comma-separated list of valid EC2 instance families (e.g.,
            t3, m5, c6g, r5b)
          default: t3
          pattern: ^[a-z][0-9]*[a-z0-9]*(,[a-z][0-9]*[a-z0-9]*)*$
          x-ui-error-message: Instance families must be comma-separated valid EC2
            families (e.g., t3,m5,c6g,r5b)
          x-ui-visible-if:
            field: spec.instance_requirements.instance_classification
            values:
            - Instance Family
        instance_types:
          type: string
          title: Instance Types
          description: Comma-separated EC2 instance types (e.g., m6i.large,c5.xlarge)
          default: m6i.large
          pattern: ^[a-z][0-9]+[a-z]*\.(nano|micro|small|medium|large|xlarge|[0-9]+xlarge)(,[a-z][0-9]+[a-z]*\.(nano|micro|small|medium|large|xlarge|[0-9]+xlarge))*$
          x-ui-error-message: Instance types must be comma-separated valid EC2 instance
            types (e.g., m6i.large,c5.xlarge)
          x-ui-visible-if:
            field: spec.instance_requirements.instance_classification
            values:
            - Instance Types
        instance_category:
          type: string
          title: Instance Category
          description: Comma-separated EC2 instance categories (e.g., c,m,r,g)
          default: c
          pattern: ^[a-z](,[a-z])*$
          x-ui-error-message: Instance categories must be comma-separated valid EC2
            categories (e.g., c,m,r,g)
          x-ui-visible-if:
            field: spec.instance_requirements.instance_classification
            values:
            - Instance Category
        cpu_range:
          type: string
          title: CPU Range
          description: Comma-separated vCPU counts to allow (e.g., 2,4,8,16).
          default: 2,4,8,16
          pattern: ^[0-9]+(,[0-9]+)*$
          x-ui-error-message: CPU range must be comma-separated numbers (e.g., 2,4,8,16)
        architectures:
          type: string
          title: CPU Architectures
          description: Comma-separated architectures to support.
          default: amd64
          enum:
          - amd64
          - arm64
          - amd64,arm64
        capacity_types:
          type: string
          title: Capacity Types
          description: Choose between cost-optimized Spot instances or reliable On-Demand
            instances.
          default: spot,on-demand
          enum:
          - spot
          - on-demand
          - spot,on-demand
        availability_zones:
          type: string
          title: Availability Zones
          description: Comma-separated AZs where nodes can be placed (leave empty
            to use all VPC zones).
          default: ''
          pattern: ^$|^[a-z0-9-]+[a-z](,[a-z0-9-]+[a-z])*$
          x-ui-error-message: Availability zones must be comma-separated valid AWS
            AZ names (e.g., us-west-2a,us-west-2b) or empty
    scaling:
      type: object
      title: Scaling Configuration
      description: Control how the node pool scales and manages resources.
      x-ui-toggle: true
      properties:
        max_cpu:
          type: string
          title: Maximum CPU
          description: Maximum total CPU cores for this node pool.
          default: '1000'
          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
          x-ui-error-message: Maximum CPU must be a valid Kubernetes resource quantity
            (e.g., 1000, 1000m, 1k)
        max_memory:
          type: string
          title: Maximum Memory
          description: Maximum total memory for this node pool (e.g., 1000Gi).
          default: 1000Gi
          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
          x-ui-error-message: Maximum memory must be a valid Kubernetes resource quantity
            (e.g., 1000Gi, 1Ti, 1000000Mi)
        consolidation_policy:
          type: string
          title: Cost Optimization
          description: How aggressively to consolidate underutilized nodes to save
            costs.
          default: WhenEmptyOrUnderutilized
          enum:
          - WhenEmpty
          - WhenEmptyOrUnderutilized
        consolidation_delay:
          type: string
          title: Consolidation Delay
          description: How long to wait before consolidating nodes (e.g., 30s, 5m).
          default: 30s
          pattern: ^[1-9][0-9]*(s|m|h)$
          x-ui-error-message: Consolidation delay must be a positive number followed
            by s (seconds), m (minutes), or h (hours)
    storage:
      type: object
      title: Storage Configuration
      description: Configure storage settings for the nodes.
      x-ui-toggle: true
      properties:
        disk_size:
          type: string
          title: Disk Size (Gi)
          description: Size of the root disk for each node (e.g., 80Gi, 100Gi).
          default: 80Gi
          pattern: ^[1-9][0-9]*Gi$
          x-ui-error-message: Disk size must be a positive number followed by Gi (e.g.,
            80Gi)
        disk_iops:
          type: integer
          title: Disk IOPS
          description: The number of IOPS for the disk (e.g., 3000, 10000, 16000).
          default: 3000
          minimum: 100
          maximum: 64000
          x-ui-error-message: Disk IOPS must be between 100 and 64000
        disk_throughput:
          type: integer
          title: Disk Throughput (MB/s)
          description: The throughput in MB/s for the disk (e.g., 125, 500, 1000).
          default: 125
          minimum: 125
          maximum: 1000
          x-ui-error-message: Disk throughput must be between 125 and 1000 MB/s
        encryption_key:
          type: string
          title: Encryption Key (Optional)
          description: KMS key ID/ARN for disk encryption (leave empty for default
            encryption).
          pattern: ^$|^arn:aws:kms:[a-z0-9-]+:[0-9]{12}:key/[a-f0-9-]+$|^[a-f0-9-]+$
          x-ui-error-message: Encryption key must be empty, a valid KMS key ID, or
            a valid KMS key ARN
    scheduling:
      type: object
      title: Workload Scheduling
      description: Control which workloads can run on these nodes.
      x-ui-toggle: true
      properties:
        node_labels:
          type: object
          title: Node Labels
          description: Labels to apply to nodes for workload targeting.
          default: {}
          x-ui-yaml-editor: true
        taints:
          type: object
          title: Node Taints
          description: Configure node taints for workload isolation. Each key represents
            a taint name with its configuration.
          default: {}
          patternProperties:
            ^[a-zA-Z0-9_-]+$:
              type: object
              title: Taint Configuration
              description: Configuration for a specific node taint.
              properties:
                key:
                  type: string
                  title: Taint Key
                  description: Key for the node taint (e.g., workload-type, nvidia.com/gpu).
                  pattern: ^[a-zA-Z0-9._/-]+$
                  minLength: 1
                  maxLength: 253
                  x-ui-error-message: Taint key must be 1-253 characters and contain
                    only alphanumeric characters, dots, slashes, hyphens, and underscores
                value:
                  type: string
                  title: Taint Value
                  description: Value for the node taint (e.g., analytics, true).
                  pattern: ^[a-zA-Z0-9._/-]*$
                  maxLength: 63
                  x-ui-error-message: Taint value must be 0-63 characters and contain
                    only alphanumeric characters, dots, slashes, hyphens, and underscores
                effect:
                  type: string
                  title: Taint Effect
                  description: Effect of the taint on pod scheduling.
                  default: NoSchedule
                  enum:
                  - NoSchedule
                  - PreferNoSchedule
                  - NoExecute
              required:
              - key
              - value
              - effect
    tags:
      type: object
      title: Additional Tags
      description: Custom tags to apply to EC2 instances for cost tracking and organization.
      x-ui-toggle: true
      x-ui-yaml-editor: true
      default: {}
  required: []
sample:
  kind: kubernetes_node_pool
  flavor: aws
  version: '1.0'
  metadata:
    name: production-nodepool
  spec:
    instance_requirements:
      instance_classification: Instance Types
      instance_types: m6i.large
      cpu_range: 4,8,16
      architectures: amd64,arm64
      capacity_types: spot,on-demand
    scaling:
      max_cpu: '500'
      max_memory: 2000Gi
      consolidation_policy: WhenEmptyOrUnderutilized
      consolidation_delay: 30s
    networking:
      subnet_type: private
    storage:
      disk_size: 100Gi
      disk_iops: 3000
      disk_throughput: 125
    scheduling:
      node_labels:
        environment: production
        workload-type: general
    tags:
      Environment: production
      Team: platform
      CostCenter: engineering
