intent: network
flavor: aws_vpc
version: '1.0'
description: Creates a Kubernetes-optimized AWS VPC with auto-calculated subnets across
  availability zones. Fixed allocation - Private (8K IPs/AZ), Public (256 IPs/AZ),
  Database (256 IPs/AZ)
clouds:
- aws
spec:
  type: object
  properties:
    vpc_cidr:
      type: string
      title: VPC CIDR Block
      description: CIDR block for the VPC (must be /16 for optimal Kubernetes workloads)
      pattern: ^([0-9]{1,3}\.){3}[0-9]{1,3}/16$
      x-ui-overrides-only: true
      x-ui-error-message: VPC CIDR must be a /16 block (e.g., 10.0.0.0/16)
      x-ui-placeholder: 10.0.0.0/16
    auto_select_azs:
      type: boolean
      title: Auto Select Availability Zones
      description: Automatically select 3 availability zones from the region
      default: true
    availability_zones:
      type: array
      title: Availability Zones
      description: List of availability zones to use (2-5 AZs supported). Only used
        when auto_select_azs is false
      x-ui-overrides-only: true
      x-ui-visible-if:
        field: spec.auto_select_azs
        values:
        - false
      minItems: 2
      maxItems: 5
    nat_gateway:
      type: object
      title: NAT Gateway Configuration
      properties:
        strategy:
          type: string
          title: NAT Gateway Strategy
          description: Choose whether to create one NAT Gateway or one per availability
            zone
          enum:
          - single
          - per_az
          default: single
      required:
      - strategy
    vpc_endpoints:
      type: object
      title: VPC Endpoints Configuration
      description: Configure VPC endpoints for AWS services to reduce data transfer
        costs and improve security
      x-ui-toggle: true
      properties:
        enable_s3:
          type: boolean
          title: Enable S3 VPC Endpoint
          description: Create a Gateway endpoint for Amazon S3 (no additional charges)
          default: true
        enable_dynamodb:
          type: boolean
          title: Enable DynamoDB VPC Endpoint
          description: Create a Gateway endpoint for Amazon DynamoDB (no additional
            charges)
          default: true
        enable_ecr_api:
          type: boolean
          title: Enable ECR API VPC Endpoint
          description: Create an Interface endpoint for Amazon ECR API (charges apply)
          default: true
        enable_ecr_dkr:
          type: boolean
          title: Enable ECR Docker VPC Endpoint
          description: Create an Interface endpoint for Amazon ECR Docker registry
            (charges apply)
          default: true
        enable_eks:
          type: boolean
          title: Enable EKS VPC Endpoint
          description: Create an Interface endpoint for Amazon EKS (charges apply)
          default: false
        enable_ec2:
          type: boolean
          title: Enable EC2 VPC Endpoint
          description: Create an Interface endpoint for Amazon EC2 (charges apply)
          default: false
        enable_ssm:
          type: boolean
          title: Enable SSM VPC Endpoint
          description: Create an Interface endpoint for AWS Systems Manager (charges
            apply)
          default: true
        enable_ssm_messages:
          type: boolean
          title: Enable SSM Messages VPC Endpoint
          description: Create an Interface endpoint for SSM Messages (charges apply)
          default: true
        enable_ec2_messages:
          type: boolean
          title: Enable EC2 Messages VPC Endpoint
          description: Create an Interface endpoint for EC2 Messages (charges apply)
          default: true
        enable_kms:
          type: boolean
          title: Enable KMS VPC Endpoint
          description: Create an Interface endpoint for AWS KMS (charges apply)
          default: false
        enable_logs:
          type: boolean
          title: Enable CloudWatch Logs VPC Endpoint
          description: Create an Interface endpoint for CloudWatch Logs (charges apply)
          default: false
        enable_monitoring:
          type: boolean
          title: Enable CloudWatch Monitoring VPC Endpoint
          description: Create an Interface endpoint for CloudWatch Monitoring (charges
            apply)
          default: false
        enable_sts:
          type: boolean
          title: Enable STS VPC Endpoint
          description: Create an Interface endpoint for AWS STS (charges apply)
          default: false
        enable_lambda:
          type: boolean
          title: Enable Lambda VPC Endpoint
          description: Create an Interface endpoint for AWS Lambda (charges apply)
          default: false
    tags:
      type: object
      title: Additional Tags
      description: Optional additional tags to apply to all VPC resources. These will
        be merged with the standard environment tags.
      x-ui-yaml-editor: true
  required:
  - vpc_cidr
  - nat_gateway
inputs:
  cloud_account:
    type: '@facets/aws_cloud_account'
    displayName: Cloud Account
    description: The AWS Cloud Account where the VPC will be created
    optional: false
    providers:
    - aws
outputs:
  default:
    type: '@facets/aws-vpc-details'
sample:
  kind: network
  flavor: aws_vpc
  version: '1.0'
  spec:
    vpc_cidr: 10.0.0.0/16
    auto_select_azs: true
    nat_gateway:
      strategy: single
    vpc_endpoints:
      enable_s3: true
      enable_dynamodb: true
      enable_ecr_api: true
      enable_ecr_dkr: true
      enable_eks: false
      enable_ec2: false
      enable_ssm: true
      enable_ssm_messages: true
      enable_ec2_messages: true
      enable_kms: false
      enable_logs: false
      enable_monitoring: false
      enable_sts: false
      enable_lambda: false
iac:
  validated_files:
  - variables.tf
